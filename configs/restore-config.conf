# Restore Configuration File
# This file contains sensitive information - keep it secure!

# Database Configuration
DB_NAME="nextcloud"
DB_USER="nextcloud"
DB_PASS="passw@rd"

# Cloudflare R2 Configuration
R2_ACCESS_KEY_ID="bf0224ba3802349c76f6f627aeb299bb"
R2_SECRET_ACCESS_KEY="4002626c9d8a8c8c5dfeef3918b06ff662253174c54f21cbc5e1bf87d8ea010c"
R2_BUCKET="nextcloud-backup"
R2_ENDPOINT="https://42cbf5797f0c36b80b1b62e20c484993.r2.cloudflarestorage.com"

# Paths
NEXTCLOUD_ROOT="/var/www/nextcloud"
NEXTCLOUD_DATA="${NEXTCLOUD_ROOT}/data"
NEXTCLOUD_CONFIG="${NEXTCLOUD_ROOT}/config"
NEXTCLOUD_APPS="${NEXTCLOUD_ROOT}/apps"

# Temporary directory for extracting backups
TEMP_DIR="/tmp/nextcloud_restore_$(date +%s)"

# Logging
LOG_FILE="/var/log/nextcloud/restore.log"
LOG_LEVEL="INFO"  # DEBUG, INFO, WARNING, ERROR

# Maintenance Mode
MAINTENANCE_MODE="true"  # Set to true to enable maintenance mode during restore

# What to restore (set to "true" to include, "false" to exclude)
RESTORE_DATA=true
RESTORE_CONFIG=true
RESTORE_APPS=true
RESTORE_DATABASE=true

# Service Control
RESTART_SERVICES=true  # Set to false to skip service restarts

# Pre-restore commands (e.g., stop services)
PRE_RESTORE_COMMANDS=(
    "systemctl stop apache2"
    "systemctl stop php8.4-fpm"
    "systemctl stop nextcloudcron.timer"
)

# Post-restore commands (e.g., fix permissions, restart services)
POST_RESTORE_COMMANDS=(
    "chown -R www-data:www-data ${NEXTCLOUD_ROOT}"
    "chmod -R 750 ${NEXTCLOUD_ROOT}"
    "chmod 640 ${NEXTCLOUD_ROOT}/config/config.php"
    "chown -R www-data:www-data ${NEXTCLOUD_DATA}"
    "systemctl start apache2"
    "systemctl start php8.4-fpm"
    "systemctl start nextcloudcron.timer"
    "sudo -u www-data php ${NEXTCLOUD_ROOT}/occ maintenance:mode --off"
    "sudo -u www-data php ${NEXTCLOUD_ROOT}/occ maintenance:repair"
    "sudo -u www-data php ${NEXTCLOUD_ROOT}/occ files:scan --all"
)
